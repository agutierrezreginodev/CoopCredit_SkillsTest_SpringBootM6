databases:
  - name: coopcredit-postgres
    databaseName: coopcredit_db
    user: coopcredit
    plan: free
    region: oregon

services:
  # Risk Central Mock Service
  - type: web
    name: risk-central-mock-service
    runtime: docker
    dockerfilePath: ./risk-central-mock-service/Dockerfile
    dockerContext: ./risk-central-mock-service
    envVars:
      - key: JAVA_OPTS
        value: "-Xmx512m -Xms256m"
      - key: SERVER_PORT
        value: "8081"
    healthCheckPath: /actuator/health
    plan: free
    region: oregon
    autoDeploy: true
  
  # Credit Application Service
  - type: web
    name: credit-application-service
    runtime: docker
    dockerfilePath: ./credit-application-service/Dockerfile
    dockerContext: ./credit-application-service
    envVars:
      - key: JAVA_OPTS
        value: "-Xmx512m -Xms256m"
      - key: SERVER_PORT
        value: "8080"
      - key: SPRING_PROFILES_ACTIVE
        value: "prod"
      - key: DATABASE_URL
        fromDatabase:
          name: coopcredit-postgres
          property: connectionString
      - key: POSTGRES_HOST
        fromDatabase:
          name: coopcredit-postgres
          property: host
      - key: POSTGRES_PORT
        fromDatabase:
          name: coopcredit-postgres
          property: port
      - key: POSTGRES_DATABASE
        fromDatabase:
          name: coopcredit-postgres
          property: database
      - key: SPRING_DATASOURCE_USERNAME
        fromDatabase:
          name: coopcredit-postgres
          property: user
      - key: SPRING_DATASOURCE_PASSWORD
        fromDatabase:
          name: coopcredit-postgres
          property: password
      - key: SPRING_JPA_HIBERNATE_DDL_AUTO
        value: "validate"
      - key: SPRING_FLYWAY_ENABLED
        value: "true"
      - key: JWT_SECRET
        generateValue: true
      - key: RISK_CENTRAL_URL
        sync: false
      - key: CORS_ALLOWED_ORIGINS
        sync: false
    healthCheckPath: /actuator/health
    plan: free
    region: oregon
    autoDeploy: true
